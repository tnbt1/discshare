<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ file_info.original_name }} - DiscShare</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .file-info-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: linear-gradient(135deg, #007AFF, #5AC8FA);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
        }
        
        .file-title {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 32px;
            text-align: center;
            word-wrap: break-word;
        }
        
        .virus-status {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 980px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .virus-status.clean {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success);
        }
        
        .virus-status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .virus-status.infected {
            background: rgba(255, 59, 48, 0.1);
            color: var(--error);
        }
        
        .virus-status.suspicious {
            background: #ffeaa7;
            color: #fdcb6e;
        }
        
        .virus-status.unknown,
        .virus-status.skipped,
        .virus-status.error {
            background: var(--surface);
            color: var(--secondary-color);
        }
        
        .preview-section {
            margin: 24px 0;
            padding: 24px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            text-align: center;
        }
        
        .preview-section img,
        .preview-section video {
            max-width: 100%;
            max-height: 400px;
            border-radius: var(--radius-small);
        }
        
        .preview-section audio {
            width: 100%;
        }
        
        .preview-section iframe {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: var(--radius-small);
        }
        
        .no-preview {
            color: var(--secondary-color);
            font-size: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            justify-content: center;
        }
        
        .btn-secondary {
            background: var(--surface);
            color: var(--primary-color);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--hover);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid var(--surface);
            border-top: 2px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .warning-message {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: var(--radius-small);
            padding: 16px;
            margin-top: 24px;
            color: #856404;
            font-size: 15px;
            text-align: center;
        }
        
        .error-message {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid var(--error);
            border-radius: var(--radius-small);
            padding: 16px;
            margin-top: 24px;
            color: var(--error);
            font-size: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">💾</span>
                <span class="logo-text">DiscShare</span>
            </div>
            <nav class="nav">
                <a href="/" class="nav-link">ホーム</a>
                <a href="#" class="nav-link">使い方</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="file-info-icon">
                {% if is_image %}
                    🖼️
                {% elif is_video %}
                    🎬
                {% elif is_audio %}
                    🎵
                {% elif is_pdf %}
                    📄
                {% else %}
                    📁
                {% endif %}
            </div>
            
            <h1 class="file-title">{{ file_info.original_name }}</h1>
            
            <div class="info">
                <div class="info-item">
                    <span class="info-icon">📦</span>
                    <span>ファイルサイズ: {{ size_str }}</span>
                </div>
                <div class="info-item">
                    <span class="info-icon">📅</span>
                    <span>アップロード日時: {{ uploaded_at }}</span>
                </div>
                <div class="info-item">
                    <span class="info-icon">📄</span>
                    <span>ファイル形式: {{ mime_type or "不明" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-icon">🛡️</span>
                    <span>ウイルススキャン: 
                        <span class="virus-status {{ virus_scan_status }}" id="overallStatus">
                            {% if virus_scan_status == "clean" %}
                                ✓ 安全
                            {% elif virus_scan_status == "pending" %}
                                <span class="loading-spinner"></span> スキャン中
                            {% elif virus_scan_status == "infected" %}
                                ⚠ 危険
                            {% elif virus_scan_status == "suspicious" %}
                                ⚠ 要注意
                            {% else %}
                                ? 不明
                            {% endif %}
                        </span>
                    </span>
                </div>
            </div>
            
            <div class="preview-section" id="previewSection">
                {% if is_image %}
                    <img src="/download/{{ token }}/{{ file_id }}" alt="{{ file_info.original_name }}">
                {% elif is_video %}
                    <video controls>
                        <source src="/download/{{ token }}/{{ file_id }}" type="{{ mime_type }}">
                        お使いのブラウザは動画の再生に対応していません。
                    </video>
                {% elif is_audio %}
                    <audio controls>
                        <source src="/download/{{ token }}/{{ file_id }}" type="{{ mime_type }}">
                        お使いのブラウザは音声の再生に対応していません。
                    </audio>
                {% elif is_pdf %}
                    <iframe src="/download/{{ token }}/{{ file_id }}"></iframe>
                {% else %}
                    <p class="no-preview">このファイルはプレビューできません</p>
                {% endif %}
            </div>
            
            {% if virus_scan_status == "infected" %}
            <div class="message error">
                <div style="display: flex; align-items: center;">
                    <span style="margin-right: 8px; font-size: 18px;">⚠️</span>
                    <span>このファイルからウイルスが検出されました。ダウンロードはできません。</span>
                </div>
            </div>
            {% elif virus_scan_status == "suspicious" %}
            <div class="warning-message">
                ⚠ このファイルは疑わしい内容を含む可能性があります。ダウンロードする際は十分ご注意ください。
            </div>
            {% endif %}
            
            <div class="button-group">
                <button class="btn btn-secondary" onclick="window.history.back()">戻る</button>
                {% if virus_scan_status != "infected" %}
                <a href="/download/{{ token }}/{{ file_id }}" 
                   class="btn" 
                   id="downloadBtn"
                   {% if virus_scan_status == "pending" %}style="pointer-events: none; opacity: 0.5;"{% endif %}>
                    ダウンロード
                </a>
                {% endif %}
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>DiscShare</h4>
                <p>Discord経由の安全なファイル共有</p>
            </div>
            <div class="footer-section">
                <div class="footer-section-inner">
                    <h4>機能</h4>
                    <ul>
                        <li><a href="#">最大5GBまで転送</a></li>
                        <li><a href="#">3日間有効</a></li>
                        <li><a href="#">ウイルススキャン</a></li>
                        <li><a href="#">自動削除</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 tnbt. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        {% if virus_scan_status == "pending" %}
        (function() {
            let checkInterval = setInterval(async () => {
                try {
                    const response = await fetch('/api/file/{{ token }}/{{ file_id }}/status');
                    const data = await response.json();
                    
                    if (data.virus_scan !== 'pending') {
                        clearInterval(checkInterval);
                        location.reload();
                    }
                } catch (error) {
                    console.error('Status check error:', error);
                }
            }, 3000);
        })();
        {% endif %}
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ file_info.original_name }} - DiscShare</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .file-info-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: linear-gradient(135deg, #007AFF, #5AC8FA);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
        }
        
        .file-title {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 32px;
            text-align: center;
            word-wrap: break-word;
        }
        
        .virus-status {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 980px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .virus-status.clean {
            background: rgba(52, 199, 89, 0.1);
            color: var(--success);
        }
        
        .virus-status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .virus-status.infected {
            background: rgba(255, 59, 48, 0.1);
            color: var(--error);
        }
        
        .virus-status.suspicious {
            background: #ffeaa7;
            color: #fdcb6e;
        }
        
        .virus-status.unknown,
        .virus-status.skipped,
        .virus-status.error {
            background: var(--surface);
            color: var(--secondary-color);
        }
        
        .preview-section {
            margin: 24px 0;
            padding: 24px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            text-align: center;
        }
        
        .preview-section img,
        .preview-section video {
            max-width: 100%;
            max-height: 400px;
            border-radius: var(--radius-small);
        }
        
        .preview-section audio {
            width: 100%;
        }
        
        .preview-section iframe {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: var(--radius-small);
        }
        
        .no-preview {
            color: var(--secondary-color);
            font-size: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            justify-content: center;
        }
        
        .btn-secondary {
            background: var(--surface);
            color: var(--primary-color);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--hover);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid var(--surface);
            border-top: 2px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .warning-message {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: var(--radius-small);
            padding: 16px;
            margin-top: 24px;
            color: #856404;
            font-size: 15px;
            text-align: center;
        }
        
        .error-message {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid var(--error);
            border-radius: var(--radius-small);
            padding: 16px;
            margin-top: 24px;
            color: var(--error);
            font-size: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">ğŸ’¾</span>
                <span class="logo-text">DiscShare</span>
            </div>
            <nav class="nav">
                <a href="/" class="nav-link">ãƒ›ãƒ¼ãƒ </a>
                <a href="#" class="nav-link">ä½¿ã„æ–¹</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="file-info-icon">
                {% if is_image %}
                    ğŸ–¼ï¸
                {% elif is_video %}
                    ğŸ¬
                {% elif is_audio %}
                    ğŸµ
                {% elif is_pdf %}
                    ğŸ“„
                {% else %}
                    ğŸ“
                {% endif %}
            </div>
            
            <h1 class="file-title">{{ file_info.original_name }}</h1>
            
            <div class="info">
                <div class="info-item">
                    <span class="info-icon">ğŸ“¦</span>
                    <span>ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: {{ size_str }}</span>
                </div>
                <div class="info-item">
                    <span class="info-icon">ğŸ“…</span>
                    <span>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚: {{ uploaded_at }}</span>
                </div>
                <div class="info-item">
                    <span class="info-icon">ğŸ“„</span>
                    <span>ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼: {{ mime_type or "ä¸æ˜" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-icon">ğŸ›¡ï¸</span>
                    <span>ã‚¦ã‚¤ãƒ«ã‚¹ã‚¹ã‚­ãƒ£ãƒ³: 
                        <span class="virus-status {{ virus_scan_status }}" id="overallStatus">
                            {% if virus_scan_status == "clean" %}
                                âœ“ å®‰å…¨
                            {% elif virus_scan_status == "pending" %}
                                <span class="loading-spinner"></span> ã‚¹ã‚­ãƒ£ãƒ³ä¸­
                            {% elif virus_scan_status == "infected" %}
                                âš  å±é™º
                            {% elif virus_scan_status == "suspicious" %}
                                âš  è¦æ³¨æ„
                            {% else %}
                                ? ä¸æ˜
                            {% endif %}
                        </span>
                    </span>
                </div>
            </div>
            
            <div class="preview-section" id="previewSection">
                {% if is_image %}
                    <img src="/download/{{ token }}/{{ file_id }}" alt="{{ file_info.original_name }}">
                {% elif is_video %}
                    <video controls>
                        <source src="/download/{{ token }}/{{ file_id }}" type="{{ mime_type }}">
                        ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»ã®å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
                    </video>
                {% elif is_audio %}
                    <audio controls>
                        <source src="/download/{{ token }}/{{ file_id }}" type="{{ mime_type }}">
                        ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°ã®å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
                    </audio>
                {% elif is_pdf %}
                    <iframe src="/download/{{ token }}/{{ file_id }}"></iframe>
                {% else %}
                    <p class="no-preview">ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã¾ã›ã‚“</p>
                {% endif %}
            </div>
            
            {% if virus_scan_status == "infected" %}
            <div class="message error">
                <div style="display: flex; align-items: center;">
                    <span style="margin-right: 8px; font-size: 18px;">âš ï¸</span>
                    <span>ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¦ã‚¤ãƒ«ã‚¹ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯ã§ãã¾ã›ã‚“ã€‚</span>
                </div>
            </div>
            {% elif virus_scan_status == "suspicious" %}
            <div class="warning-message">
                âš  ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç–‘ã‚ã—ã„å†…å®¹ã‚’å«ã‚€å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹éš›ã¯ååˆ†ã”æ³¨æ„ãã ã•ã„ã€‚
            </div>
            {% endif %}
            
            <div class="button-group">
                <button class="btn btn-secondary" onclick="window.history.back()">æˆ»ã‚‹</button>
                {% if virus_scan_status != "infected" %}
                <a href="/download/{{ token }}/{{ file_id }}" 
                   class="btn" 
                   id="downloadBtn"
                   {% if virus_scan_status == "pending" %}style="pointer-events: none; opacity: 0.5;"{% endif %}>
                    ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </a>
                {% endif %}
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>DiscShare</h4>
                <p>DiscordçµŒç”±ã®å®‰å…¨ãªãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰</p>
            </div>
            <div class="footer-section">
                <div class="footer-section-inner">
                    <h4>æ©Ÿèƒ½</h4>
                    <ul>
                        <li><a href="#">æœ€å¤§5GBã¾ã§è»¢é€</a></li>
                        <li><a href="#">3æ—¥é–“æœ‰åŠ¹</a></li>
                        <li><a href="#">ã‚¦ã‚¤ãƒ«ã‚¹ã‚¹ã‚­ãƒ£ãƒ³</a></li>
                        <li><a href="#">è‡ªå‹•å‰Šé™¤</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 tnbt. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        {% if virus_scan_status == "pending" %}
        (function() {
            let checkInterval = setInterval(async () => {
                try {
                    const response = await fetch('/api/file/{{ token }}/{{ file_id }}/status');
                    const data = await response.json();
                    
                    if (data.virus_scan !== 'pending') {
                        clearInterval(checkInterval);
                        location.reload();
                    }
                } catch (error) {
                    console.error('Status check error:', error);
                }
            }, 3000);
        })();
        {% endif %}
    </script>
</body>
</html>